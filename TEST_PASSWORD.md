# 密码保护测试步骤

## 1. 重启服务器

**务必完全停止旧的服务器进程，然后重新启动：**

```bash
# 停止旧的服务器（Ctrl+C 或关闭终端）
# 然后重新启动
node signaling-server.js
```

## 2. 清除浏览器缓存

**重要：必须硬刷新或清除缓存！**

- Chrome/Edge: `Ctrl+Shift+R` (Windows) 或 `Cmd+Shift+R` (Mac)
- Firefox: `Ctrl+F5`
- 或者：打开无痕/隐私模式窗口

## 3. 测试步骤

### 步骤 A：创建有密码的房间

1. 打开浏览器访问应用
2. 选择"取件码模式"
3. 选择一个文件
4. **勾选** "🔒 设置接收密码"
5. 输入密码，例如：`test123`
6. 点击"生成取件码"
7. 记录生成的6位取件码

**此时服务器应该输出：**
```
🏠 房间创建成功: 123456 by XXX 🔒 (有密码保护)
```

### 步骤 B：不输入密码尝试加入

1. 打开另一个浏览器标签页（或无痕窗口）
2. 选择"输入取件码"
3. 输入刚才的6位取件码
4. **不要勾选** "🔒 房间有密码保护" 复选框
5. 点击"开始接收文件"

**此时服务器应该输出：**
```
[DEBUG] 加入房间请求 - 房间: 123456, 用户: XXX, 提供的密码: undefined
[DEBUG] 房间密码状态 - 房间密码: "test123"
[DEBUG] 房间需要密码验证
❌ XXX 未提供密码，无法加入房间: 123456
```

**浏览器应该显示错误：** "❌ 此房间需要密码"

### 步骤 C：输入错误密码尝试加入

1. **勾选** "🔒 房间有密码保护"
2. 输入错误密码：`wrong`
3. 点击"开始接收文件"

**此时服务器应该输出：**
```
[DEBUG] 加入房间请求 - 房间: 123456, 用户: XXX, 提供的密码: "wrong"
[DEBUG] 房间密码状态 - 房间密码: "test123"
[DEBUG] 房间需要密码验证
❌ XXX 密码错误，无法加入房间: 123456 (提供: "wrong", 正确: "test123")
```

**浏览器应该显示错误：** "❌ 密码错误"

### 步骤 D：输入正确密码加入

1. **勾选** "🔒 房间有密码保护"
2. 输入正确密码：`test123`
3. 点击"开始接收文件"

**此时服务器应该输出：**
```
[DEBUG] 加入房间请求 - 房间: 123456, 用户: XXX, 提供的密码: "test123"
[DEBUG] 房间密码状态 - 房间密码: "test123"
[DEBUG] 房间需要密码验证
✅ XXX 密码验证成功
👤 XXX 加入房间: 123456 (密码验证通过)
```

**浏览器应该成功进入房间**

## 4. 请提供

测试后，请把 **服务器控制台的完整输出** 发给我，特别是 `[DEBUG]` 开头的那几行。这样我就能看到到底哪里出了问题。

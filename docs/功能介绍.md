# MeshKit 功能介绍

## 系统概述

MeshKit 是一个基于 WebRTC 技术构建的去中心化点对点协作工具套件。系统的核心设计理念是将数据传输的控制权完全交还给用户，通过点对点直连的方式，确保所有协作数据都直接在用户设备之间传输，而不经过任何第三方服务器。这种去中心化的架构设计从根本上保障了用户的数据隐私和安全。

系统采用现代化的技术栈构建，包括 TypeScript、React、Electron 等主流技术。整体架构采用 Monorepo 方式组织，核心业务逻辑被抽取为独立的 core 包，可以被 Web 应用、桌面应用等不同平台的客户端共享使用。这种设计不仅提高了代码复用率，也保证了各平台功能的一致性。

在安全性方面，MeshKit 实施了多层防护策略。所有通过 WebRTC 建立的连接都自动启用 DTLS/SRTP 传输层加密，为文件传输和便签同步提供基础的安全保障。对于即时通讯场景，系统进一步实现了基于 libsodium 加密库的端到端加密机制，使用 256 位密钥确保通讯内容的绝对隐私。这种分层的安全设计既保证了系统的高性能，又满足了不同场景下的安全需求。

## 核心功能模块

### 文件传输模块

文件传输模块是 MeshKit 的核心功能之一，它解决了用户在不同设备间快速、安全传输文件的需求。传统的文件传输方式往往需要先将文件上传到云端服务器，然后再从服务器下载到目标设备，这个过程不仅耗时，还存在隐私泄露的风险。MeshKit 的文件传输模块通过 WebRTC Data Channel 技术，在设备间建立直接的点对点连接，让文件可以直接从发送设备传输到接收设备，完全绕过了服务器这个中间环节。

在用户体验方面，系统提供了直观简洁的操作界面。用户可以通过点击选择文件，也可以直接将文件拖拽到应用窗口中，系统会自动处理文件的读取和分片。传输过程中，界面会实时显示传输进度、当前速度以及预估的剩余时间，让用户对传输状态有清晰的了解。对于多个文件的传输，系统会自动建立传输队列，按顺序逐个完成传输。

技术实现上，系统采用流式传输机制处理文件。具体来说，文件会被分割成多个 64KB 的数据块，然后逐块通过 WebRTC 连接发送。这种设计的好处是即使传输 GB 级别的大文件，也不会占用大量内存，系统只需要在内存中保持少量的缓冲数据即可。接收端同样采用流式接收和组装的方式，确保了整个传输过程的高效性。

在安全性方面，所有通过 WebRTC 传输的数据都经过 DTLS 协议加密。DTLS 是 TLS 协议在 UDP 传输上的实现，它提供了与 HTTPS 相当的安全级别。这意味着即使在公共网络环境下，传输的文件内容也无法被网络窃听者获取。同时，每次建立新的连接时，系统都会协商生成新的加密密钥，实现了完美前向保密特性，即使某次连接的密钥泄露，也不会影响其他连接的安全性。

性能方面，在局域网环境下，MeshKit 的文件传输速度通常可以达到 20-50 MB/s，具体速度取决于网络质量和设备性能。如果使用 5GHz 频段的 WiFi 网络，传输速度会明显优于 2.4GHz 频段。对于跨网络的传输场景，系统会通过 STUN/TURN 服务器辅助完成 NAT 穿透，虽然速度可能不如局域网，但仍能保证稳定的传输。

### 便签墙模块

便签墙模块为团队协作提供了一个虚拟的协作看板。它的设计灵感来源于真实世界中的便签纸和白板，团队成员可以在上面贴上各种颜色的便签，记录想法、任务或问题，并通过拖动便签来组织和分类信息。MeshKit 将这种协作方式数字化，并通过点对点技术实现了多人实时同步。

系统的核心技术是 Yjs CRDT（无冲突复制数据类型）。CRDT 是一种特殊的数据结构，它的设计目标是让多个副本可以独立地进行修改，然后通过算法自动合并这些修改，而不会产生冲突。这个特性非常适合协作场景，因为它意味着多个用户可以同时编辑便签墙，而不需要复杂的锁机制或冲突解决界面。所有的编辑操作都会被转换为 CRDT 操作，通过 WebRTC 连接实时同步到其他在线设备，整个过程对用户是透明的。

在功能实现上，用户可以通过点击按钮快速创建新便签，每个便签支持文本内容的编辑。系统提供了多种预设颜色，用户可以通过更改便签颜色来进行分类管理，比如用红色表示紧急任务，用黄色表示普通任务，用绿色表示已完成任务。便签的位置可以通过鼠标拖拽自由调整，位置的变化会立即同步到所有连接的设备。删除便签的操作同样会实时同步，确保所有用户看到的都是最新状态。

数据持久化是便签墙的另一个重要特性。所有便签数据都保存在浏览器的 IndexedDB 数据库中，这意味着即使刷新页面或关闭浏览器，便签数据仍然保留。当用户再次打开应用时，之前创建的所有便签都会自动恢复。这种本地存储的设计不仅提高了响应速度，也进一步保护了数据隐私，因为便签内容永远不会上传到云端服务器。

协作体验方面，当多个设备连接到同一个便签墙时，所有设备会自动建立点对点连接。任何一个设备上的修改操作都会在不到 100 毫秒的时间内同步到其他设备，这种低延迟的实时同步让协作变得流畅自然。即使某个设备暂时离线，它在离线期间所做的修改也会被保存在本地，等重新上线后自动与其他设备同步，CRDT 算法会自动处理期间可能产生的冲突。

安全方面，便签墙的同步数据同样通过 WebRTC 的 DTLS 加密传输。虽然便签内容保存在本地未加密，但传输过程中的加密保护可以防止网络窃听。对于包含敏感信息的协作场景，建议在内网环境下使用，或者使用加密聊天模块来传递真正敏感的信息。

### 加密聊天模块

加密聊天模块是 MeshKit 在安全性上的重要体现，它提供了真正的端到端加密即时通讯能力。与普通的聊天应用不同，MeshKit 的加密聊天从设计之初就将安全和隐私放在首位，采用了与 Signal、WhatsApp 等主流加密通讯应用相同级别的加密技术。

加密的核心是 libsodium（也称为 NaCl）加密库。这是一个专门为网络通讯设计的现代加密库，它提供了简单易用的 API，同时保证了极高的安全性。系统使用的是 NaCl 的 crypto_box 加密模式，这个模式结合了 XSalsa20 流密码和 Poly1305 消息认证码，前者负责加密消息内容，后者负责验证消息的完整性和真实性。所有消息都使用 256 位的密钥进行加密，这个密钥长度与军事、金融系统使用的加密强度相同。

密钥管理采用了 ECDH（椭圆曲线 Diffie-Hellman）密钥交换算法。具体来说，当两个设备建立聊天连接时，每个设备会生成一对密钥：公钥和私钥。私钥永远保存在本地设备不会发送出去，而公钥会通过已加密的 WebRTC 连接发送给对方。双方收到对方的公钥后，使用 ECDH 算法结合自己的私钥和对方的公钥，计算出一个共享密钥。神奇的是，虽然双方独立计算，但得到的共享密钥是完全相同的，这个共享密钥就用于后续消息的加密和解密。整个过程完全自动化，用户无需进行任何操作。

消息的发送流程是这样的：用户在输入框中输入消息并点击发送，系统会先用共享密钥对消息进行加密，同时生成一个随机的 Nonce（一次性数字），Nonce 的作用是确保即使相同的消息多次发送，产生的密文也完全不同，这可以防止重放攻击。加密后的密文和 Nonce 一起通过 WebRTC 连接发送给对方。接收方收到后，使用相同的共享密钥和 Nonce 对密文进行解密，还原出原始消息。Poly1305 消息认证码会自动验证消息是否被篡改，如果验证失败，消息会被拒绝。

安全性方面，加密聊天实现了真正的端到端加密。这意味着消息在发送方设备上加密，在接收方设备上解密，中间的任何环节都无法读取消息内容。即使是负责转发连接信令的服务器，也只能看到加密后的密文，无法解密出实际内容。这种设计确保了即使服务器被攻击或服务器运营方恶意，用户的通讯内容仍然是安全的。

隐私保护方面，系统采用了消息即焚的设计。所有聊天消息只保存在浏览器的内存中，不会写入磁盘。当用户刷新页面或关闭应用时，所有消息都会被清空，不留任何痕迹。这种设计虽然无法保留历史记录，但最大程度地保护了用户隐私。对于需要保留的重要信息，用户需要手动记录到其他地方。

完美前向保密是另一个重要的安全特性。由于每次建立连接都会生成新的密钥对，即使某次连接的密钥不慎泄露（比如设备被物理访问），也只会影响那次连接的消息，不会影响之前或之后的通讯。这大大降低了密钥泄露的风险。

### 信令服务器

虽然 MeshKit 的核心理念是去中心化，但设备之间建立点对点连接之前，仍然需要一个中介来帮助设备发现彼此并交换连接信息。这就是信令服务器的作用。需要强调的是，信令服务器只参与连接建立过程，一旦点对点连接建立成功，所有数据都直接在设备间传输，不再经过服务器。

信令服务器提供两个主要服务。第一个是 WebSocket 服务，用于设备注册和在线状态管理。当客户端启动时，会通过 WebSocket 连接到信令服务器，注册自己的设备信息并获得一个唯一的 Peer ID。服务器会维护一个在线设备列表，并通过 WebSocket 将这个列表广播给所有连接的客户端。当有设备上线或下线时，服务器会及时更新列表并推送通知。这让用户可以实时看到哪些设备在线可用。

第二个服务是 PeerJS 服务器，它是 WebRTC 连接协商的核心。当设备 A 想要连接设备 B 时，它会向服务器发送连接请求，服务器将请求转发给设备 B。然后双方开始交换 SDP（会话描述协议）信息和 ICE（交互式连接建立）候选地址。SDP 描述了双方支持的媒体格式、编解码器等信息，而 ICE 候选地址是设备可能的网络地址，包括本地地址、公网地址等。通过这些信息的交换，WebRTC 底层会自动选择最优的连接路径，如果双方在同一局域网，会直接使用局域网地址连接；如果需要跨网络，会尝试各种 NAT 穿透技术。

服务器还实现了心跳检测机制。客户端会定期向服务器发送心跳消息，证明自己仍然在线。如果服务器在一定时间内没有收到某个设备的心跳，就会将其标记为离线并从设备列表中移除。这确保了设备列表的准确性，避免用户看到已经离线的设备。

在部署方面，信令服务器可以运行在各种环境中。对于本地开发和测试，可以直接在本机运行，使用 localhost 地址。对于局域网使用场景，可以在局域网内的一台服务器上运行，所有设备连接到这个服务器即可。对于需要跨地域使用的场景，可以将服务器部署到公网云服务器，配置好域名和 HTTPS 证书。MeshKit 提供了 Docker 镜像，可以一键启动信令服务器，简化了部署流程。

## 系统集成

MeshKit 的三大功能模块虽然在用户界面上是独立的，但在底层实现上是高度集成的。它们共享同一个点对点连接，通过消息类型来区分不同功能的数据。这种设计避免了为每个功能建立单独连接的开销，提高了系统效率。

具体来说，当两个设备建立连接后，会创建一个 WebRTC Data Channel。这个 Data Channel 可以传输任意二进制数据。系统定义了不同的消息类型，比如 "FILE_CHUNK" 表示文件分片数据，"NOTE_UPDATE" 表示便签更新操作，"CHAT_MESSAGE" 表示聊天消息。发送方在发送数据时会附加消息类型标识，接收方根据类型将数据分发到相应的处理模块。

设备发现和在线状态是全局共享的。无论用户当前在使用哪个功能，都可以看到完整的在线设备列表。当用户在文件传输模块选择了一个设备后，切换到聊天模块时，同一个设备仍然是可选的，因为它们使用的是同一个底层连接。这种设计提供了一致的用户体验。

配置管理方面，系统提供了统一的设置页面，用户可以配置信令服务器的地址和端口。这个配置会保存在浏览器的 localStorage 中，应用启动时会自动加载。这对于局域网部署场景特别有用，用户可以配置使用内网的信令服务器，而不是默认的 localhost。

错误处理和重连机制也是统一实现的。当网络连接中断时，系统会自动尝试重新连接到信令服务器并重建点对点连接。重连过程是自动的，用户通常不需要手动干预。对于文件传输等有状态的操作，当前版本在连接断开时会失败，需要用户重新发起传输。

## 技术特点

从技术架构来看，MeshKit 采用了现代化的前端技术栈。TypeScript 提供了完整的类型安全保障，大大减少了运行时错误。React 18 的并发特性和自动批处理提升了应用性能和响应速度。Vite 构建工具提供了极快的开发服务器和优化的生产构建。整个项目采用 Monorepo 结构，使用 pnpm workspaces 和 Turborepo 管理，这种组织方式让代码共享和依赖管理变得简单高效。

性能方面，系统在多个层面进行了优化。文件传输采用流式处理，避免了大文件带来的内存压力。便签墙使用 CRDT 增量同步，只传输变化的部分而不是整个文档。加密操作虽然计算密集，但通过密钥缓存和批量处理减少了开销。在局域网环境下，系统可以充分利用高带宽低延迟的特性，提供接近本地操作的体验。

安全性是 MeshKit 的核心竞争力。多层次的加密保护确保了不同场景下的安全需求。WebRTC 的传输层加密为所有连接提供基础保护，端到端加密为敏感通讯提供最高级别保护。完美前向保密机制降低了密钥泄露的风险。零日志设计从根本上避免了数据泄露的可能。所有这些安全特性都是默认启用的，用户无需进行任何配置。

用户体验方面，系统追求简洁直观。所有核心功能都可以在几次点击内完成，不需要复杂的配置或学习过程。界面设计遵循现代设计规范，提供了清晰的视觉反馈和操作提示。错误提示信息准确明了，帮助用户快速定位和解决问题。跨平台的一致性设计让用户在不同设备上都能获得相同的体验。

可扩展性是系统设计时的重要考量。核心业务逻辑与界面层分离，使得添加新平台支持变得容易。模块化的架构让新功能可以独立开发和集成。开放的源代码和清晰的文档降低了二次开发的门槛。基于标准的 WebRTC 协议确保了与其他实现的互操作性。

## 应用场景

MeshKit 适用于多种协作场景。在企业办公环境中，它可以作为内网文件传输和团队协作的工具。员工可以通过便签墙进行头脑风暴和任务管理，通过加密聊天讨论敏感的商业信息，通过文件传输快速分享大型文档或设计稿。由于所有数据都在内网传输，不经过外部服务器，既保证了速度也满足了企业的安全合规要求。

在教育培训场景中，教师可以使用便签墙与学生进行实时互动。学生可以在便签墙上提出问题、分享想法或提交作业。教师可以实时看到所有学生的反馈并进行指导。文件传输功能可以用来分发课件或收集学生作品。整个过程不需要依赖外部网络，在校园网环境下就能流畅运行。

对于远程团队，MeshKit 提供了一套完整的协作工具。团队成员可以在便签墙上规划项目、分配任务、跟踪进度。通过加密聊天进行日常沟通，讨论技术问题或决策方案。需要传输代码包、设计文件或测试数据时，可以直接点对点传输，避免了上传下载的等待时间。

个人用户可以用 MeshKit 在自己的多个设备间同步数据。比如在手机上拍摄的照片需要传到电脑上编辑，或者电脑上的文档需要传到平板上查看，都可以通过文件传输快速完成。便签墙可以作为个人的任务管理工具或灵感记录工具，在所有设备间保持同步。

对于有高安全需求的专业人士，如律师、医生、记者等，加密聊天模块提供了安全的通讯渠道。他们可以用它来传递客户信息、病历数据或敏感新闻线索，确保信息不会被第三方获取。消息即焚的特性也避免了敏感信息长期保存带来的风险。

临时协作场景也是 MeshKit 的优势所在。比如在会议中需要快速分享文件，或者几个人临时组成小组讨论问题，都可以快速建立连接开始协作，结束后各自退出即可，不需要注册账号或建立长期关系。这种轻量级的使用方式非常适合临时性的协作需求。

## 总结

MeshKit 通过点对点技术和端到端加密，为用户提供了一个安全、高效、易用的协作平台。它不是简单地复制现有工具的功能，而是从隐私保护和去中心化的角度重新思考协作工具应该是什么样的。通过将数据控制权交还给用户，MeshKit 让协作变得更加安全和自由。

系统当前的三大功能模块已经可以满足大多数基础协作需求，清晰的架构设计为未来扩展留下了空间。无论是添加新的协作功能，还是支持更多平台，都可以在现有基础上进行。开源的代码和详细的文档也欢迎社区贡献，共同完善这个项目。

MeshKit 证明了即使在云计算和中心化服务主导的今天，点对点技术仍然有其独特的价值。在某些场景下，点对点的方案可以提供更好的性能、更高的安全性和更强的隐私保护。这也许能为互联网应用的发展提供一个不同的方向。

# MeshKit 使用说明

## 文档说明

本文档为 MeshKit 系统的使用说明，采用段落化的叙述方式详细介绍系统的安装步骤和使用方法。文档面向初次使用的用户，通过连贯的文字描述帮助用户理解系统的各个方面，从环境准备到功能使用，提供完整的指导。

## 第一部分：环境准备与安装

### 检查系统环境

在开始安装之前，首先需要确认您的计算机满足运行 MeshKit 的基本要求。MeshKit 是一个跨平台的应用，可以运行在 Windows 10 及以上版本、macOS 10.13 及以上版本，以及主流的 Linux 发行版（如 Ubuntu 18.04+、Fedora 30+ 等）上。如果您计划使用 Web 版本，浏览器方面建议使用 Google Chrome 90 或更高版本，Microsoft Edge 90 或更高版本，Firefox 88 或更高版本，或者 Safari 14 或更高版本，这些浏览器对 WebRTC 技术有良好的支持。

网络环境方面，MeshKit 虽然可以在各种网络环境下工作，但为了获得最佳性能，建议使用稳定的网络连接。如果是局域网内的协作场景，使用 WiFi 或有线网络都可以，其中 5GHz 频段的 WiFi 会比 2.4GHz 频段提供更好的传输速度。另外需要注意的是，如果您的网络环境有防火墙，需要确保防火墙允许 WebRTC 连接，这对于建立点对点连接是必需的。

### 安装开发环境

MeshKit 需要 Node.js 运行环境来构建和运行。您需要访问 Node.js 官方网站（https://nodejs.org）下载安装包。建议选择 LTS（长期支持）版本，版本号应该是 18.x 或更高。下载完成后双击安装包，按照安装向导的提示完成安装即可，通常保持默认选项就可以了。安装完成后，打开命令行工具（Windows 下是命令提示符或 PowerShell，macOS 和 Linux 下是终端），输入 node -v 命令，如果能看到版本号输出，说明 Node.js 已经成功安装。

接下来需要安装 pnpm 包管理器。pnpm 是一个更高效的包管理工具，MeshKit 使用它来管理项目依赖。在命令行中输入 npm install -g pnpm 命令即可安装。这个过程通常只需要几秒到几十秒。安装完成后同样可以用 pnpm -v 命令验证安装是否成功。

如果您想从 GitHub 获取最新的源代码，还需要安装 Git 版本控制工具。访问 Git 官方网站（https://git-scm.com）下载对应操作系统的安装包，运行安装程序并保持默认设置完成安装。安装完成后需要重启命令行工具使环境变量生效。

### 获取项目代码

有两种方式可以获取 MeshKit 的源代码。如果您已经安装了 Git，推荐使用克隆方式。打开命令行工具，切换到您想要存放项目的目录，然后执行 git clone 命令从 GitHub 仓库下载代码。克隆完成后会在当前目录下创建一个 MeshKit 文件夹，使用 cd MeshKit 命令进入项目目录。

如果没有安装 Git 也没关系，可以直接从 GitHub 页面下载压缩包。在项目的 GitHub 页面上点击绿色的 "Code" 按钮，选择 "Download ZIP" 即可下载。下载完成后将压缩包解压到本地目录，然后在命令行中进入解压后的项目目录。

进入项目目录后，您会看到几个主要的文件夹。packages 目录包含了客户端代码，其中 core 是核心逻辑包，web 是浏览器版本，desktop 是桌面应用版本。apps 目录下的 signaling 是信令服务器的代码。docs 目录包含了各种文档。根目录下的 package.json 是项目的主配置文件，pnpm-workspace.yaml 定义了工作空间配置。

### 安装项目依赖

获取代码后，需要安装项目所需的所有依赖包。确保当前在项目根目录，然后执行 pnpm install 命令。这个命令会读取 package.json 文件，下载并安装所有需要的依赖包。首次安装可能需要较长时间，具体取决于网络速度，通常需要 5 到 15 分钟。如果网络环境不好或下载速度很慢，可以配置使用国内的镜像源来加速。

如果您在国内使用，可以通过 pnpm config set registry https://registry.npmmirror.com 命令配置使用淘宝的 npm 镜像。配置后再执行 pnpm install，下载速度会显著提升。如果安装过程中出现错误，可以尝试删除 node_modules 目录（如果存在）后重新执行安装命令。

依赖安装完成后，还有一个重要的步骤是构建核心包。由于核心包是用 TypeScript 编写的，需要编译为 JavaScript 才能被其他包使用。执行 pnpm --filter @meshkit/core build 命令来构建核心包。这个过程通常只需要几秒到一分钟。看到 "Build completed" 或类似的成功提示后，说明核心包已经构建完成。Web 应用和桌面应用都依赖核心包，所以这一步是必须的，如果跳过这一步，后续启动应用时会报错。

### Docker 快速部署

如果您熟悉 Docker 并且希望更快速地部署，MeshKit 提供了 Docker 支持。首先确保已经安装了 Docker。Windows 和 macOS 用户可以安装 Docker Desktop，Linux 用户可以通过系统包管理器安装 Docker。安装并启动 Docker 后，在项目根目录执行 docker-compose up -d 命令即可一键启动所有服务。

首次使用 Docker Compose 启动时，系统会自动下载基础镜像并构建应用镜像，这个过程可能需要较长时间。构建完成后，容器会自动启动。您可以通过 docker-compose ps 命令查看容器运行状态，通过 docker-compose logs -f 命令查看日志输出。使用 Docker 部署的好处是环境完全隔离，不需要在本机安装 Node.js 等依赖，所有东西都运行在容器中。

## 第二部分：启动和访问系统

### 启动服务

如果您使用传统方式安装（非 Docker），需要启动信令服务器和 Web 应用。MeshKit 提供了一键启动脚本，在项目根目录执行 pnpm dev 命令，这个命令会同时启动信令服务器和 Web 应用，非常方便。启动过程中您会看到编译和启动的日志信息，当看到 "Signaling server started on port 7000"、"PeerJS server started on port 8000" 以及 "Local: http://localhost:3000" 等信息时，说明所有服务都已成功启动。

如果您希望分别控制各个服务，也可以打开多个命令行窗口分别启动。第一个窗口中执行 pnpm dev:signaling 启动信令服务器，第二个窗口中执行 pnpm dev:web 启动 Web 应用。这种方式的好处是可以分别查看各个服务的日志，在调试时比较有用。

对于桌面应用，需要单独启动。打开新的命令行窗口，进入 packages/desktop 目录，然后执行 pnpm dev 命令。Electron 窗口会自动打开，显示桌面版的 MeshKit 应用。桌面应用内置了所有功能，使用体验与 Web 版本完全相同，但作为独立窗口运行，不占用浏览器标签页，而且可以更好地与系统集成。

### 访问应用

服务启动成功后，就可以开始使用了。如果使用 Web 版本，打开浏览器（推荐 Chrome 或 Edge），在地址栏输入 http://localhost:3000 并回车。页面会显示 MeshKit 的主界面，顶部是导航标签，可以切换文件传输、便签墙和加密聊天三个功能。右上角显示您的设备信息，点击设置图标可以进入配置页面，点击帮助图标可以查看使用帮助。

如果启动的是桌面应用，Electron 窗口会自动打开并加载应用界面。桌面应用的界面与 Web 版本基本相同，只是运行在独立的窗口中。您可以像使用普通桌面软件一样调整窗口大小、最小化、最大化等。

首次访问时，您可能会看到设备列表为空。这是正常的，因为当前只有您一个设备在线。要体验协作功能，需要在其他设备上也打开 MeshKit。

### 多设备连接

MeshKit 的协作功能需要多个设备同时在线。如果您想在同一局域网的其他设备上使用，需要先找到运行服务器的电脑的 IP 地址。

在 Windows 系统上，打开命令提示符，输入 ipconfig 命令，找到"IPv4 地址"一项，通常是 192.168.x.x 或 10.0.x.x 格式的地址。在 macOS 系统上，打开终端，输入 ifconfig 命令，找到 en0 或 en1 网卡下的 inet 地址。在 Linux 系统上，可以使用 ip addr 或 ifconfig 命令查看网络接口的 IP 地址。

找到 IP 地址后，确保其他设备与服务器在同一个 WiFi 网络。在其他设备的浏览器中输入 http://[服务器IP]:3000 即可访问。例如，如果服务器 IP 是 192.168.1.100，则在其他设备浏览器中输入 http://192.168.1.100:3000。手机、平板等移动设备也可以直接通过浏览器访问，不需要安装专门的应用。

访问成功后，两个设备都会在设备列表中看到对方。设备列表通常显示设备的 Peer ID 和在线状态。绿色的指示灯表示设备在线可用，灰色表示离线。此时就可以开始使用各项协作功能了。

需要注意的是，如果其他设备无法访问，可能是防火墙的问题。Windows 系统首次启动服务可能会弹出防火墙提示，需要选择"允许访问"。如果仍然无法连接，可以临时关闭防火墙测试，确认是防火墙问题后再配置相应的规则。

### 配置信令服务器

在某些场景下，您可能需要配置自定义的信令服务器地址。比如信令服务器部署在局域网的其他机器上，或者部署在公网的云服务器上。MeshKit 提供了设置页面来配置这些参数。

点击应用右上角的设置图标（齿轮图标），进入设置页面。您会看到信令服务器配置区域，包含三个输入框：服务器主机地址、WebSocket 端口和 PeerJS 端口。

主机地址可以填写 IP 地址或域名。如果服务器在本机，填写 localhost。如果在局域网其他机器，填写该机器的 IP 地址，如 192.168.1.100。如果部署在公网，填写服务器的公网 IP 或域名，如 meshkit.example.com。

端口通常使用默认值即可，WebSocket 端口默认是 7000，PeerJS 端口默认是 8000。如果服务器使用了不同的端口，需要相应修改。配置完成后点击"保存配置"按钮，配置会保存到浏览器的本地存储中。为了使配置生效，需要刷新页面。刷新后应用会使用新的配置连接到信令服务器。

## 第三部分：功能使用

### 使用文件传输

文件传输功能让您可以在设备间快速传输文件。首先确保至少有两个设备在线，在主界面点击顶部的"文件传输"标签进入文件传输功能。

界面会显示两个模式切换按钮："发送"和"接收"。如果您要发送文件，点击"发送"按钮。界面会显示文件选择区域，您可以点击"选择文件"按钮打开文件选择对话框，选择一个或多个文件。按住 Ctrl（Windows/Linux）或 Command（macOS）键可以选择多个文件。您也可以直接将文件从文件管理器拖拽到应用窗口中，系统会自动识别并添加到待发送列表。

选择文件后，界面会显示文件的基本信息，包括文件名、大小和类型。接下来需要选择接收设备，在设备列表中点击要发送到的设备，设备名称会高亮显示表示已选中。然后点击"发送文件"按钮开始传输。

传输过程中，界面会显示详细的进度信息。进度条以可视化的方式展示当前进度，旁边的百分比数字精确到小数点后一位。传输速度以 MB/s 为单位实时更新，让您了解当前的传输速率。剩余时间根据当前速度估算，会随着速度变化动态调整。在局域网环境下，传输速度通常可以达到 20-50 MB/s，传输 100MB 的文件只需要几秒钟。

当进度达到 100% 时，传输完成。接收方会看到"接收完成"的提示，点击"下载文件"按钮即可将文件保存到本地。浏览器会弹出保存对话框，选择保存位置后确认即可。

如果是在移动设备上接收文件，操作略有不同。特别是 iOS 的 Safari 浏览器，点击下载按钮后文件会在新标签页打开，需要长按文件然后选择"存储到文件"，选择保存位置（可以是 iCloud 或本地）来保存文件。

如果需要传输多个文件，可以在选择文件时一次选择多个，或者分多次拖拽添加。系统会自动建立传输队列，按顺序逐个传输。当前正在传输的文件会高亮显示，已完成的文件会有相应的标记。

### 使用便签墙

便签墙功能提供了一个虚拟的协作看板，适合团队头脑风暴、任务管理等场景。点击顶部导航的"便签墙"标签进入功能。

首次进入时会看到一个空白的画布。点击左上角的"+ 添加便签"按钮可以创建新便签。新便签会立即出现在画布上，系统会自动分配一个颜色，光标会自动定位到便签的文本区域，您可以直接开始输入内容。便签支持多行文本，按回车键可以换行。输入的内容会实时保存，不需要手动保存操作。

如果要修改便签内容，直接点击便签的文本区域即可进入编辑状态。编辑完成后点击便签外的任意位置退出编辑。要更改便签颜色，点击便签上的颜色选择器图标（通常是调色盘图标），在弹出的颜色列表中选择想要的颜色，便签颜色会立即改变。通过颜色可以对便签进行分类，比如红色表示紧急任务，黄色表示普通任务，绿色表示已完成任务。

便签的位置可以自由调整。将鼠标移到便签上，按住鼠标左键拖动便签到想要的位置，释放鼠标便签就固定在新位置。您可以通过位置来组织便签，比如把相关的便签放在一起，或者用左右位置表示任务的不同状态。

如果要删除便签，点击便签上的删除按钮（垃圾桶图标）。便签会立即消失，删除操作是不可撤销的，所以需要谨慎操作。

便签墙真正强大的地方在于多人协作。当多个设备打开便签墙时，它们会自动建立连接并同步数据。任何一个设备上的操作，包括添加便签、编辑内容、更改颜色、移动位置或删除便签，都会在不到 100 毫秒的时间内同步到其他所有设备。这种低延迟的实时同步让多人协作变得非常流畅。

即使某个设备暂时离线，它在离线期间的修改也会保存在本地。当设备重新上线后，这些修改会自动与其他设备同步。系统使用 CRDT 技术自动处理可能产生的冲突，确保最终所有设备的数据都是一致的。

所有便签数据都保存在浏览器的本地数据库（IndexedDB）中。这意味着即使关闭浏览器或刷新页面，便签数据仍然保留。下次打开时之前的所有便签会自动恢复。但需要注意的是，如果清除浏览器数据，便签也会被删除，所以重要的内容建议备份。

### 使用加密聊天

加密聊天功能提供了端到端加密的即时通讯能力。点击顶部导航的"加密聊天"标签进入聊天功能。

界面分为左右两部分，左侧是在线设备列表，右侧是聊天窗口。要开始聊天，首先在设备列表中选择想要聊天的设备，点击后该设备会高亮显示。系统会自动开始建立加密连接，这个过程包括自动生成密钥对、交换公钥、计算共享密钥等步骤，通常在 1-2 秒内完成。整个过程完全自动化，您不需要进行任何操作。

连接建立后，设备名称旁边会显示绿色的状态指示灯，表示加密连接已就绪，可以开始发送消息。此时所有的加密基础设施都已准备好，每条消息都会自动加密后再发送。

发送消息很简单，在底部的输入框中输入消息内容，然后按回车键或点击发送按钮即可。如果需要输入多行文本，可以按 Shift+Enter 组合键换行。消息发送后会显示在聊天窗口的右侧，用蓝色气泡表示。同时，对方设备会立即收到消息，经过自动解密后显示在他们的聊天窗口左侧，用灰色气泡表示。每条消息都会显示发送时间。

消息的加密和解密过程对用户是完全透明的。在发送方，消息在输入框输入的明文，点击发送后系统立即用 256 位的共享密钥加密，同时生成一个随机的 Nonce 确保即使相同的消息多次发送密文也不同。加密后的密文通过 WebRTC 连接发送。在接收方，收到密文后系统用相同的共享密钥解密，还原出原始消息显示在界面上。整个过程中，密文经过的所有中间节点（包括信令服务器）都无法解密消息内容。

安全性方面，加密聊天实现了真正的端到端加密。这意味着只有通讯双方能读取消息内容，任何第三方包括服务器运营者都无法窃听。使用的加密算法是经过广泛审计的 NaCl（libsodium）库，加密强度与 Signal、WhatsApp 等主流加密通讯应用相同。每次连接都会生成新的密钥对，实现完美前向保密，即使某次连接的密钥泄露也不会影响其他连接的安全性。

隐私保护方面，所有聊天消息只保存在内存中，不会写入磁盘。当您刷新页面或关闭应用时，所有消息都会被清空，不留任何痕迹。这种设计虽然意味着无法保留历史记录，但最大程度地保护了您的隐私。如果需要保留某些重要信息，需要手动复制到其他地方保存。

您可以与多个设备聊天，在设备列表中选择不同的设备即可切换聊天对象。每个聊天窗口的消息是独立的，切换时不会丢失。但需要注意的是，由于消息不持久化，刷新页面后所有聊天窗口的消息都会清空。

## 第四部分：常见问题处理

### 安装和启动相关问题

在安装或启动过程中，可能会遇到一些常见问题。如果启动服务时提示端口被占用，说明默认端口（3000、7000、8000）已经被其他程序使用。解决方法是找到并关闭占用端口的程序，或者修改 MeshKit 的配置使用其他端口。可以在 apps/signaling/src/index.ts 文件中修改 WS_PORT 和 PEER_PORT 常量，在 packages/web/vite.config.ts 文件中修改 server.port 配置。

如果 pnpm install 很慢或失败，通常是网络问题。可以配置使用国内镜像源来解决。另外也要检查网络连接是否稳定，防火墙或代理软件是否阻止了连接。如果问题持续，可以尝试删除 node_modules 目录和 pnpm-lock.yaml 文件，然后重新执行安装。

如果构建核心包时提示 TypeScript 错误，可能是代码版本问题或依赖版本不匹配。确保使用的是最新版本的代码，Node.js 版本满足要求（18 或更高）。如果问题仍然存在，可以尝试完全清理后重新安装。

### 连接和使用相关问题

如果设备列表为空看不到其他设备，首先要确认信令服务器是否正常运行。可以查看命令行窗口的日志输出，确认服务器已经启动。然后检查所有设备是否连接到同一个信令服务器，如果有设备配置了不同的服务器地址，就无法相互发现。还要确认防火墙是否允许相关端口的连接。

如果能看到设备但无法连接，可能是防火墙阻止了 WebRTC 连接，或者 NAT 穿透失败。尝试在防火墙中允许 WebRTC 相关的端口和协议。如果使用的是企业网络或复杂的路由环境，可能需要配置 TURN 服务器来中继流量。在局域网环境下，确保所有设备在同一个网段通常可以解决问题。

如果连接经常断开，检查网络是否稳定，设备是否设置了自动休眠。使用更稳定的网络连接，关闭设备的自动休眠功能，靠近路由器增强信号都可能有所帮助。

文件传输速度慢的问题通常与网络有关。局域网环境下，使用 5GHz 频段的 WiFi 比 2.4GHz 快很多。减少设备与路由器的距离，关闭其他占用网络的程序，或使用有线网络连接都能提高速度。跨网络传输受带宽限制，速度会明显低于局域网。

便签同步有延迟通常是网络延迟导致的。改善网络连接质量，减少同时连接的设备数量，使用局域网而非广域网都有助于降低延迟。如果使用了网络代理，也可能增加延迟，可以尝试直连。

加密聊天无法连接时，可以尝试刷新页面重新建立连接。检查信令服务器是否正常运行，查看浏览器控制台是否有错误信息。确认双方设备都在线且网络正常。如果问题持续，可以尝试关闭防火墙测试是否是防火墙的问题。

## 第五部分：进阶配置

### 生产环境部署（可选）

本项目主要面向本地和局域网使用场景。如需在生产环境部署或配置 HTTPS、域名等，请自行配置相关服务器和网络设置。

### 性能优化建议

要获得最佳性能，网络优化是关键。使用有线网络代替 WiFi 可以获得更稳定的连接和更高的带宽。如果必须使用 WiFi，选择 5GHz 频段并确保信号强度良好。在路由器上配置 QoS（服务质量）可以为 MeshKit 保证带宽。

系统资源方面，关闭不必要的后台程序可以释放更多资源给 MeshKit。增加浏览器的内存限制，使用性能模式的电源方案（而非节能模式）都有助于提升性能。

对于文件传输，选择合适的网络环境很重要。局域网传输速度远高于跨网络传输。传输大文件时确保设备不会进入休眠状态，保持屏幕常亮和网络连接活跃。

## 第六部分：获取帮助和支持

### 使用内置帮助

MeshKit 应用内置了帮助页面，点击右上角的问号图标即可进入。帮助页面包含了常见问题解答、使用技巧、快速入门指南等内容。这是最方便快捷的获取帮助的方式。

### 查阅文档

项目提供了完整的文档集，包括功能介绍、使用说明、开发指南、API 文档、部署指南等。这些文档位于 docs 目录下，可以使用文本编辑器或 Markdown 阅读器查看。文档中包含了详细的说明和示例，能够解决大部分问题。

### 社区支持

遇到问题时，可以访问项目的 GitHub 页面，在 Issues 区域搜索是否有人遇到过类似问题。如果没有找到，可以创建新的 Issue 描述您的问题，提供详细的错误信息、操作步骤和环境信息，这样更容易获得帮助。

GitHub Discussions 是一个交流经验的好地方，可以在这里与其他用户讨论使用技巧、分享经验、提出建议等。

### 诊断问题

当遇到问题时，查看浏览器控制台（按 F12 打开开发者工具）可以获得详细的错误信息。控制台中的错误消息通常能帮助定位问题。在寻求帮助时提供控制台的错误日志会使问题更容易被解决。

对于服务器端的问题，查看命令行窗口的日志输出也很重要。日志中包含了服务器的运行状态和错误信息，可以帮助判断问题是出在客户端还是服务器端。

## 总结

通过以上的说明，您应该已经了解了如何安装、配置和使用 MeshKit 系统。从环境准备到功能使用，每个步骤都进行了详细的说明。MeshKit 的设计理念是简单易用，大部分操作都是直观的，不需要复杂的配置。遇到问题时，可以参考常见问题部分或查阅其他文档，也欢迎通过 GitHub 获取社区支持。希望 MeshKit 能够为您的协作工作带来便利，享受安全、高效的点对点协作体验。

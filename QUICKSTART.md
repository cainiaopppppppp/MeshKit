# 快速开始 - 增强的 P2P 传输功能

## 🎉 新功能速览

本次更新为 P2P 文件传输应用添加了三个核心增强功能：

### 1. ✏️ 设备名编辑
用户可以自定义设备名称，方便识别和区分不同的设备。

### 2. 🔒 密码保护
发送方可以设置密码，接收方需要输入正确密码才能接收文件。

### 3. 🔐 端到端加密
文件内容被加密传输，支持 5 种加密算法，确保传输安全。

---

## 📖 使用指南

### 设备名编辑

**步骤：**
1. 打开应用，在设备名右侧看到"铅笔"编辑图标
2. 点击编辑图标
3. 在弹出的对话框中输入新的设备名（最多20个字符）
4. 点击"保存"
5. 新设备名会立即同步到所有在线设备

**示例：**
```
默认名称：💻电脑-A3F2
自定义名称：张三的笔记本
```

---

### 密码保护 + 端到端加密

#### 发送方操作

**步骤1：选择文件**
- 点击或拖拽文件到上传区域
- 支持单个文件或多个文件

**步骤2：选择接收设备**
- 从设备列表中选择目标设备

**步骤3：配置安全选项**
点击"发送文件"后，会弹出"文件传输设置"对话框：

**选项 A：仅密码保护**
```
☑ 设置密码保护
☐ 启用端到端加密

作用：接收方需要输入密码才能接收文件
文件内容：不加密（WebRTC 传输通道已加密）
适用场景：防止误传，快速验证身份
```

**选项 B：端到端加密**
```
☐ 设置密码保护
☑ 启用端到端加密
   加密算法：AES-256-CBC（推荐）

作用：文件内容被加密，必须有密码才能解密
传输速度：稍慢（需要加密处理）
适用场景：敏感文件、高安全需求
```

**选项 C：双重保护**
```
☑ 设置密码保护
☑ 启用端到端加密
   加密算法：AES-256-GCM（最安全）

作用：接收验证 + 内容加密，最高安全级别
适用场景：机密文件、高度敏感数据
```

**选项 D：无保护**
```
☐ 设置密码保护
☐ 启用端到端加密

作用：直接传输（仅WebRTC通道加密）
传输速度：最快
适用场景：信任的设备，普通文件
```

**步骤4：设置密码**
- 输入密码（至少4个字符）
- 再次输入密码确认
- 点击"确定"开始传输

#### 接收方操作

**步骤1：等待接收请求**
接收方会看到接收提示（未来版本会有确认对话框）

**步骤2：输入密码（如果需要）**
- 如果文件有密码保护或加密，需要输入密码
- 显示文件信息：
  ```
  来自：张三的笔记本
  文件名：重要文档.pdf
  大小：2.5 MB
  🔒 需要密码（有密码保护）
  🔐 已加密（内容加密，算法：AES-256-CBC）
  ```

**步骤3：接收文件**
- 输入正确密码
- 点击"接受"开始接收
- 如果启用了加密，文件会自动解密
- 接收完成后点击"下载文件"

---

## 🔐 加密算法选择指南

| 算法 | 安全性 | 速度 | 推荐场景 |
|------|--------|------|----------|
| **AES-256-CBC** | ⭐⭐⭐⭐⭐ | 快 | ✅ **推荐** 日常使用 |
| **AES-256-GCM** | ⭐⭐⭐⭐⭐+ | 稍慢 | 最高安全需求 |
| **Rabbit** | ⭐⭐⭐⭐ | 极快 | 大文件快速传输 |
| **TripleDES** | ⭐⭐⭐ | 慢 | 向后兼容 |
| **RC4** | ⭐⭐ | 快 | ❌ 不推荐 |

**文件大小建议：**
- < 10 MB → AES-256-GCM（最安全）
- 10-100 MB → AES-256-CBC（平衡）
- 100 MB - 1 GB → Rabbit（快速）
- > 1 GB → 建议不加密（性能影响）

---

## 🎯 使用场景示例

### 场景1：发送普通文件给信任的朋友
```
选择：无保护
原因：朋友设备可信，普通照片
优点：传输最快
```

### 场景2：发送工作文档
```
选择：密码保护（不加密）
原因：防止误传给错误的设备
优点：快速验证接收者身份
```

### 场景3：发送合同、财务报表
```
选择：端到端加密
算法：AES-256-CBC
原因：敏感文件需要内容保护
优点：文件内容安全
```

### 场景4：发送极度机密文件
```
选择：密码保护 + 端到端加密
算法：AES-256-GCM
原因：最高安全级别
优点：接收验证 + 内容加密 + HMAC完整性校验
```

---

## 🔒 安全保证

### WebRTC 传输加密
- 所有传输自动使用 DTLS/SRTP 加密
- 即使不启用文件加密，传输通道也是安全的
- 防止中间人攻击

### 密码保护机制
- 密码不会明文传输
- 使用验证 token 机制
- PBKDF2 哈希（100,000次迭代）

### 端到端文件加密
- 发送方加密，接收方解密
- 支持多种加密算法
- AES-GCM 模式使用 HMAC 认证，确保数据完整性

### P2P 直连
- 数据不经过中心服务器
- 点对点传输，无第三方存储
- 文件仅在内存中处理（大文件除外）

---

## 💡 提示和技巧

### 密码管理
- 使用强密码（包含字母、数字、符号）
- 不要重复使用相同的密码
- 可以通过其他安全渠道（如短信）分享密码

### 传输优化
- 大文件建议不加密（或使用 Rabbit 算法）
- 加密会增加 CPU 占用和传输时间
- 可以先压缩再加密传输

### 疑难解答
- 密码错误：仔细检查密码，注意大小写
- 传输失败：检查网络连接，刷新页面重试
- 文件损坏：如果启用加密，确保密码正确

---

## 📋 当前状态

### ✅ 已实现功能
- [x] 设备名编辑
- [x] 密码对话框 UI
- [x] 接收确认对话框 UI
- [x] 文件加密工具类（5种算法）
- [x] 密码验证机制
- [x] UI 集成（发送流程）

### ⏳ 下一步计划
- [ ] 接收确认对话框集成（显示）
- [ ] FileTransferManager 加密逻辑集成
- [ ] 取件码模式加密支持
- [ ] 加密/解密进度显示
- [ ] 完整的端到端测试

---

## 📚 更多信息

- **详细技术文档**：查看 `FILE_ENCRYPTION_GUIDE.md`
- **架构说明**：查看 `ARCHITECTURE.md`
- **API 文档**：查看 `packages/core/src/utils/FileEncryption.ts`

---

## 🤝 反馈和建议

如有问题或建议，欢迎反馈：
- 在 Issues 中提交问题
- 贡献代码改进

---

**享受更安全、更便捷的 P2P 文件传输！** 🚀
